
  CREATE TABLE "ACMMH"."SIS_RECIBOLUZ_ORG" 
   (	"COD_ORGRECIBO_LUZ" NUMBER NOT NULL ENABLE, 
	"NUM_LECTURA_INICIAL" NUMBER(12,4), 
	"NUM_LECTURA_FINAL" NUMBER(12,4), 
	"NUM_MONTO" NUMBER(12,4), 
	"NUM_COSTO_WATS" NUMBER(12,4), 
	"FEC_PERIODO" VARCHAR2(20 BYTE), 
	"NUM_PENDIENTE_FAC" NUMBER(12,4), 
	"NUM_ESTADO" NUMBER, 
	"REPOMANCNX" NUMBER(12,4), 
	"CARGOFIJO" NUMBER(12,4), 
	"ALUMPUBLIC" NUMBER(12,4), 
	"SUBTOTALMES" NUMBER(12,4), 
	"IGV" NUMBER(12,4), 
	"TOTALMESACT" NUMBER(12,4), 
	"APORTELEY" NUMBER(12,4), 
	"CUOTACONV" NUMBER(12,4), 
	"REDONMESACT" NUMBER(12,4), 
	"REDONMESANT" NUMBER(12,4), 
	"INTERESCONVENIO" NUMBER(12,4), 
	"ENERGACTFRAPTAACTUAL" NUMBER(12,4), 
	"ENERGACTFRAPTAANTERI" NUMBER(12,4), 
	"ENERGACTFRAPTADIFER" NUMBER(12,4), 
	"ENERGACTFRAPTAFACTOR" NUMBER(12,4), 
	"ENERGACTFRAPTACONSU" NUMBER(12,4), 
	"ENERGACTFRAPTACONFA" NUMBER(12,4), 
	"ENERGACTFRAPTAPREUNI" NUMBER(12,4), 
	"ENERGACTFRAPTATOTAL" NUMBER(12,4), 
	"ENERGACTHORPTAACTU" NUMBER(12,4), 
	"ENERGACTHORPTAANT" NUMBER(12,4), 
	"ENERGACTHORPTADIF" NUMBER(12,4), 
	"ENERGACTHORPTAFAC" NUMBER(12,4), 
	"ENERGACTHORPTACONS" NUMBER(12,4), 
	"ENERGACTHORPTACONFAC" NUMBER(12,4), 
	"ENERGACTHORPTAPREUNI" NUMBER(12,4), 
	"ENERGACTHORPTATOTAL" NUMBER(12,4), 
	"ENERGREACINICIAL" NUMBER(12,4), 
	"ENERGREACANTERI" NUMBER(12,4), 
	"ENERGREACDIFERE" NUMBER(12,4), 
	"ENERGREACFACTOR" NUMBER(12,4), 
	"ENERGREACCONSU" NUMBER(12,4), 
	"ENERGREACFACCONS" NUMBER(12,4), 
	"ENERGREACPREUNI" NUMBER(12,4), 
	"ENERGREACTOTAL" NUMBER(12,4), 
	"POTENCIAFPINI" NUMBER(12,4), 
	"POTENCIAFPANTE" NUMBER(12,4), 
	"POTENCIAFPDIF" NUMBER(12,4), 
	"POTENCIAFPFAC" NUMBER(12,4), 
	"POTENCIAFPCONS" NUMBER(12,4), 
	"POTENCIAHPACT" NUMBER(12,4), 
	"POTENCIAHPANT" NUMBER(12,4), 
	"POTENCIAHPDIF" NUMBER(12,4), 
	"POTENCIAHPFAC" NUMBER(12,4), 
	"POTENCIAHPCONS" NUMBER(12,4), 
	"POTUSOREDDISTCONFAC" NUMBER(12,4), 
	"POTUSOREDDISTPREUNI" NUMBER(12,4), 
	"POTGENFPCONFAC" NUMBER(12,4), 
	"POTGENFPPREUNI" NUMBER(12,4), 
	"POTUSOREDDISTTOTAL" NUMBER(12,4), 
	"POTGENFPTOTAL" NUMBER(12,4), 
	"FECVENCIMIENTO" VARCHAR2(20 BYTE), 
	"FECEMISION" VARCHAR2(20 BYTE), 
	 CONSTRAINT "SIS_RECIBO_LUZ_PK" PRIMARY KEY ("COD_ORGRECIBO_LUZ")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;

   CREATE SEQUENCE  "ACMMH"."SQ_RECIBO_LUZ_ORIGINAL"  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE ;
   

   
   
   
   
   
create or replace PACKAGE "PKG_RECIBO_LUZ_ORIG" AS
TYPE CUR_LIST IS REF CURSOR;
-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
PROCEDURE SP_INS_RECIBOORILUZ(  
    p_FEC_PERIODO          IN SIS_RECIBOLUZ_ORG.FEC_PERIODO%type DEFAULT NULL ,
    p_FECVENCIMIENTO       IN SIS_RECIBOLUZ_ORG.FECVENCIMIENTO%type DEFAULT NULL,
    p_FECEMISION           IN SIS_RECIBOLUZ_ORG.FECEMISION%type DEFAULT NULL,
    p_NUM_COSTO_WATS       IN SIS_RECIBOLUZ_ORG.NUM_COSTO_WATS%type DEFAULT NULL ,
    p_NUM_ESTADO           IN SIS_RECIBOLUZ_ORG.NUM_ESTADO%type DEFAULT NULL ,
    p_REPOMANCNX           IN SIS_RECIBOLUZ_ORG.REPOMANCNX%type DEFAULT NULL ,
    p_CARGOFIJO            IN SIS_RECIBOLUZ_ORG.CARGOFIJO%type DEFAULT NULL ,
    p_ENERGACTFRAPTAACTUAL IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTAACTUAL%type DEFAULT NULL ,
    p_ENERGACTFRAPTAANTERI IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTAANTERI%type DEFAULT NULL ,
    p_ENERGACTFRAPTADIFER  IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTADIFER%type DEFAULT NULL ,
    p_ENERGACTFRAPTAFACTOR IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTAFACTOR%type DEFAULT NULL ,	
    p_ENERGACTFRAPTACONSU  IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTACONSU%type DEFAULT NULL ,
    p_ENERGACTFRAPTACONFA  IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTACONFA%type DEFAULT NULL ,
    p_ENERGACTFRAPTAPREUNI IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTAPREUNI%type DEFAULT NULL ,
    p_ENERGACTFRAPTATOTAL  IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTATOTAL%type DEFAULT NULL ,
    p_ENERGACTHORPTAACTU   IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTAACTU%type DEFAULT NULL ,
    p_ENERGACTHORPTAANT    IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTAANT%type DEFAULT NULL ,	
    p_ENERGACTHORPTADIF    IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTADIF%type DEFAULT NULL ,
    p_ENERGACTHORPTAFAC    IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTAFAC%type DEFAULT NULL ,	
    p_ENERGACTHORPTACONS   IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTACONS%type DEFAULT NULL ,
    p_ENERGACTHORPTACONFAC IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTACONFAC%type DEFAULT NULL ,
    p_ENERGACTHORPTAPREUNI IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTAPREUNI%type DEFAULT NULL ,
    p_ENERGACTHORPTATOTAL  IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTATOTAL%type DEFAULT NULL ,
    p_ENERGREACINICIAL     IN SIS_RECIBOLUZ_ORG.ENERGREACINICIAL%type DEFAULT NULL ,
    p_ENERGREACANTERI      IN SIS_RECIBOLUZ_ORG.ENERGREACANTERI%type DEFAULT NULL ,
    p_ENERGREACDIFERE      IN SIS_RECIBOLUZ_ORG.ENERGREACDIFERE%type DEFAULT NULL ,
    p_ENERGREACFACTOR      IN SIS_RECIBOLUZ_ORG.ENERGREACFACTOR%type DEFAULT NULL ,	
    p_ENERGREACCONSU       IN SIS_RECIBOLUZ_ORG.ENERGREACCONSU%type DEFAULT NULL ,
    p_ENERGREACFACCONS     IN SIS_RECIBOLUZ_ORG.ENERGREACFACCONS%type DEFAULT NULL ,
    p_ENERGREACPREUNI      IN SIS_RECIBOLUZ_ORG.ENERGREACPREUNI%type DEFAULT NULL ,
    p_ENERGREACTOTAL       IN SIS_RECIBOLUZ_ORG.ENERGREACTOTAL%type DEFAULT NULL ,    
    p_INTERESCONVENIO      IN SIS_RECIBOLUZ_ORG.INTERESCONVENIO%type DEFAULT NULL ,
    p_POTENCIAFPINI        IN SIS_RECIBOLUZ_ORG.POTENCIAFPINI%type DEFAULT NULL ,
    p_POTENCIAFPANTE       IN SIS_RECIBOLUZ_ORG.POTENCIAFPANTE%type DEFAULT NULL ,
    p_POTENCIAFPDIF        IN SIS_RECIBOLUZ_ORG.POTENCIAFPDIF%type DEFAULT NULL ,
    p_POTENCIAFPFAC        IN SIS_RECIBOLUZ_ORG.POTENCIAFPFAC%type DEFAULT NULL ,
    p_POTENCIAFPCONS       IN SIS_RECIBOLUZ_ORG.POTENCIAFPCONS%type DEFAULT NULL ,
    p_POTENCIAHPACT        IN SIS_RECIBOLUZ_ORG.POTENCIAHPACT%type DEFAULT NULL ,
    p_POTENCIAHPANT        IN SIS_RECIBOLUZ_ORG.POTENCIAHPANT%type DEFAULT NULL ,
    p_POTENCIAHPDIF        IN SIS_RECIBOLUZ_ORG.POTENCIAHPDIF%type DEFAULT NULL ,
    p_POTENCIAHPFAC        IN SIS_RECIBOLUZ_ORG.POTENCIAHPFAC%type DEFAULT NULL ,
    p_POTENCIAHPCONS       IN SIS_RECIBOLUZ_ORG.POTENCIAHPCONS%type DEFAULT NULL ,
    p_POTUSOREDDISTCONFAC  IN SIS_RECIBOLUZ_ORG.POTUSOREDDISTCONFAC%type DEFAULT NULL,
    p_POTUSOREDDISTPREUNI  IN SIS_RECIBOLUZ_ORG.POTUSOREDDISTPREUNI%type DEFAULT NULL ,
    p_POTUSOREDDISTTOTAL   IN SIS_RECIBOLUZ_ORG.POTUSOREDDISTTOTAL%type DEFAULT NULL,
    p_POTGENFPCONFAC       IN SIS_RECIBOLUZ_ORG.POTGENFPCONFAC%type DEFAULT NULL ,
    p_POTGENFPPREUNI       IN SIS_RECIBOLUZ_ORG.POTGENFPPREUNI%type DEFAULT NULL ,
    p_POTGENFPTOTAL        IN SIS_RECIBOLUZ_ORG.POTGENFPTOTAL%type DEFAULT NULL,
    p_ALUMPUBLIC           IN SIS_RECIBOLUZ_ORG.ALUMPUBLIC%type DEFAULT NULL ,
    p_SUBTOTALMES          IN SIS_RECIBOLUZ_ORG.SUBTOTALMES%type DEFAULT NULL ,    
    p_IGV                  IN SIS_RECIBOLUZ_ORG.IGV%type DEFAULT NULL ,
    p_TOTALMESACT          IN SIS_RECIBOLUZ_ORG.TOTALMESACT%type DEFAULT NULL ,
    p_APORTELEY            IN SIS_RECIBOLUZ_ORG.APORTELEY%type DEFAULT NULL ,
    p_CUOTACONV            IN SIS_RECIBOLUZ_ORG.CUOTACONV%type DEFAULT NULL ,
    p_REDONMESANT          IN SIS_RECIBOLUZ_ORG.REDONMESANT%type DEFAULT NULL ,
    p_REDONMESACT          IN SIS_RECIBOLUZ_ORG.REDONMESACT%type DEFAULT NULL ,
    /*p_NUM_MONTO            IN SIS_RECIBOLUZ_ORG.NUM_MONTO%type DEFAULT NULL ,
    p_NUM_LECTURA_INICIAL  IN SIS_RECIBOLUZ_ORG.NUM_LECTURA_INICIAL%type DEFAULT NULL ,    
    p_NUM_LECTURA_FINAL    IN SIS_RECIBOLUZ_ORG.NUM_LECTURA_FINAL%type ,
    p_NUM_PENDIENTE_FAC    IN SIS_RECIBOLUZ_ORG.NUM_PENDIENTE_FAC%type DEFAULT NULL,*/
    vo_codigo_recibo       OUT NUMBER,
    vo_indicador           OUT VARCHAR,
    vo_mensaje             OUT VARCHAR);
-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
  PROCEDURE SP_REPORTE_LUZ_ORIG(vi_pagina                 IN  NUMBER,
                              vi_registros              IN  NUMBER,
                              vi_codigo_recibo_luz_orig IN  VARCHAR,
                              vo_total_registros        OUT NUMBER,
                              vo_result                 OUT SYS_REFCURSOR);
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
END PKG_RECIBO_LUZ_ORIG;





create or replace PACKAGE BODY "PKG_RECIBO_LUZ_ORIG" 
AS

PROCEDURE SP_INS_RECIBOORILUZ(  
    p_FEC_PERIODO          IN SIS_RECIBOLUZ_ORG.FEC_PERIODO%type DEFAULT NULL ,
    p_FECVENCIMIENTO       IN SIS_RECIBOLUZ_ORG.FECVENCIMIENTO%type DEFAULT NULL,
    p_FECEMISION           IN SIS_RECIBOLUZ_ORG.FECEMISION%type DEFAULT NULL,
    p_NUM_COSTO_WATS       IN SIS_RECIBOLUZ_ORG.NUM_COSTO_WATS%type DEFAULT NULL ,
    p_NUM_ESTADO           IN SIS_RECIBOLUZ_ORG.NUM_ESTADO%type DEFAULT NULL ,
    p_REPOMANCNX           IN SIS_RECIBOLUZ_ORG.REPOMANCNX%type DEFAULT NULL ,
    p_CARGOFIJO            IN SIS_RECIBOLUZ_ORG.CARGOFIJO%type DEFAULT NULL ,
    p_ENERGACTFRAPTAACTUAL IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTAACTUAL%type DEFAULT NULL ,
    p_ENERGACTFRAPTAANTERI IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTAANTERI%type DEFAULT NULL ,
    p_ENERGACTFRAPTADIFER  IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTADIFER%type DEFAULT NULL ,
    p_ENERGACTFRAPTAFACTOR IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTAFACTOR%type DEFAULT NULL ,	
    p_ENERGACTFRAPTACONSU  IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTACONSU%type DEFAULT NULL ,
    p_ENERGACTFRAPTACONFA  IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTACONFA%type DEFAULT NULL ,
    p_ENERGACTFRAPTAPREUNI IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTAPREUNI%type DEFAULT NULL ,
    p_ENERGACTFRAPTATOTAL  IN SIS_RECIBOLUZ_ORG.ENERGACTFRAPTATOTAL%type DEFAULT NULL ,
    p_ENERGACTHORPTAACTU   IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTAACTU%type DEFAULT NULL ,
    p_ENERGACTHORPTAANT    IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTAANT%type DEFAULT NULL ,	
    p_ENERGACTHORPTADIF    IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTADIF%type DEFAULT NULL ,
    p_ENERGACTHORPTAFAC    IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTAFAC%type DEFAULT NULL ,	
    p_ENERGACTHORPTACONS   IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTACONS%type DEFAULT NULL ,
    p_ENERGACTHORPTACONFAC IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTACONFAC%type DEFAULT NULL ,
    p_ENERGACTHORPTAPREUNI IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTAPREUNI%type DEFAULT NULL ,
    p_ENERGACTHORPTATOTAL  IN SIS_RECIBOLUZ_ORG.ENERGACTHORPTATOTAL%type DEFAULT NULL ,
    p_ENERGREACINICIAL     IN SIS_RECIBOLUZ_ORG.ENERGREACINICIAL%type DEFAULT NULL ,
    p_ENERGREACANTERI      IN SIS_RECIBOLUZ_ORG.ENERGREACANTERI%type DEFAULT NULL ,
    p_ENERGREACDIFERE      IN SIS_RECIBOLUZ_ORG.ENERGREACDIFERE%type DEFAULT NULL ,
    p_ENERGREACFACTOR      IN SIS_RECIBOLUZ_ORG.ENERGREACFACTOR%type DEFAULT NULL ,	
    p_ENERGREACCONSU       IN SIS_RECIBOLUZ_ORG.ENERGREACCONSU%type DEFAULT NULL ,
    p_ENERGREACFACCONS     IN SIS_RECIBOLUZ_ORG.ENERGREACFACCONS%type DEFAULT NULL ,
    p_ENERGREACPREUNI      IN SIS_RECIBOLUZ_ORG.ENERGREACPREUNI%type DEFAULT NULL ,
    p_ENERGREACTOTAL       IN SIS_RECIBOLUZ_ORG.ENERGREACTOTAL%type DEFAULT NULL ,    
    p_INTERESCONVENIO      IN SIS_RECIBOLUZ_ORG.INTERESCONVENIO%type DEFAULT NULL ,
    p_POTENCIAFPINI        IN SIS_RECIBOLUZ_ORG.POTENCIAFPINI%type DEFAULT NULL ,
    p_POTENCIAFPANTE       IN SIS_RECIBOLUZ_ORG.POTENCIAFPANTE%type DEFAULT NULL ,
    p_POTENCIAFPDIF        IN SIS_RECIBOLUZ_ORG.POTENCIAFPDIF%type DEFAULT NULL ,
    p_POTENCIAFPFAC        IN SIS_RECIBOLUZ_ORG.POTENCIAFPFAC%type DEFAULT NULL ,
    p_POTENCIAFPCONS       IN SIS_RECIBOLUZ_ORG.POTENCIAFPCONS%type DEFAULT NULL ,
    p_POTENCIAHPACT        IN SIS_RECIBOLUZ_ORG.POTENCIAHPACT%type DEFAULT NULL ,
    p_POTENCIAHPANT        IN SIS_RECIBOLUZ_ORG.POTENCIAHPANT%type DEFAULT NULL ,
    p_POTENCIAHPDIF        IN SIS_RECIBOLUZ_ORG.POTENCIAHPDIF%type DEFAULT NULL ,
    p_POTENCIAHPFAC        IN SIS_RECIBOLUZ_ORG.POTENCIAHPFAC%type DEFAULT NULL ,
    p_POTENCIAHPCONS       IN SIS_RECIBOLUZ_ORG.POTENCIAHPCONS%type DEFAULT NULL ,
    p_POTUSOREDDISTCONFAC  IN SIS_RECIBOLUZ_ORG.POTUSOREDDISTCONFAC%type DEFAULT NULL,
    p_POTUSOREDDISTPREUNI  IN SIS_RECIBOLUZ_ORG.POTUSOREDDISTPREUNI%type DEFAULT NULL ,
    p_POTUSOREDDISTTOTAL   IN SIS_RECIBOLUZ_ORG.POTUSOREDDISTTOTAL%type DEFAULT NULL,
    p_POTGENFPCONFAC       IN SIS_RECIBOLUZ_ORG.POTGENFPCONFAC%type DEFAULT NULL ,
    p_POTGENFPPREUNI       IN SIS_RECIBOLUZ_ORG.POTGENFPPREUNI%type DEFAULT NULL ,
    p_POTGENFPTOTAL        IN SIS_RECIBOLUZ_ORG.POTGENFPTOTAL%type DEFAULT NULL,
    p_ALUMPUBLIC           IN SIS_RECIBOLUZ_ORG.ALUMPUBLIC%type DEFAULT NULL ,
    p_SUBTOTALMES          IN SIS_RECIBOLUZ_ORG.SUBTOTALMES%type DEFAULT NULL ,    
    p_IGV                  IN SIS_RECIBOLUZ_ORG.IGV%type DEFAULT NULL ,
    p_TOTALMESACT          IN SIS_RECIBOLUZ_ORG.TOTALMESACT%type DEFAULT NULL ,
    p_APORTELEY            IN SIS_RECIBOLUZ_ORG.APORTELEY%type DEFAULT NULL ,
    p_CUOTACONV            IN SIS_RECIBOLUZ_ORG.CUOTACONV%type DEFAULT NULL ,
    p_REDONMESANT          IN SIS_RECIBOLUZ_ORG.REDONMESANT%type DEFAULT NULL ,
    p_REDONMESACT          IN SIS_RECIBOLUZ_ORG.REDONMESACT%type DEFAULT NULL ,
    /*p_NUM_MONTO            IN SIS_RECIBOLUZ_ORG.NUM_MONTO%type DEFAULT NULL ,
    p_NUM_LECTURA_INICIAL  IN SIS_RECIBOLUZ_ORG.NUM_LECTURA_INICIAL%type DEFAULT NULL ,    
    p_NUM_LECTURA_FINAL    IN SIS_RECIBOLUZ_ORG.NUM_LECTURA_FINAL%type ,
    p_NUM_PENDIENTE_FAC    IN SIS_RECIBOLUZ_ORG.NUM_PENDIENTE_FAC%type DEFAULT NULL,*/
    vo_codigo_recibo       OUT NUMBER,
    vo_indicador           OUT VARCHAR,
    vo_mensaje             OUT VARCHAR)
IS
vl_codigo                 NUMBER;
vl_periodo                VARCHAR2(10);
BEGIN

select CONCAT( SUBSTR(p_FEC_PERIODO,instr(p_FEC_PERIODO,' ')+1,4) , CASE WHEN UPPER(substr(p_FEC_PERIODO,1,instr(p_FEC_PERIODO,' ')-1))='OCTOBER' THEN 10 END ) PERIODO INTO vl_periodo from dual;
--select CONCAT( SUBSTR(p_FEC_PERIODO,instr(p_FEC_PERIODO,' ')+1,4) , CASE WHEN substr(p_FEC_PERIODO,1,instr(p_FEC_PERIODO,' ')-1)='OCTUBRE' THEN 10 END ) PERIODO INTO vl_periodo from dual;


  SELECT SQ_RECIBO_LUZ_ORIGINAL.NEXTVAL INTO vl_codigo FROM DUAL;
  INSERT
  INTO SIS_RECIBOLUZ_ORG
    (
      ENERGREACFACCONS ,
      ENERGACTHORPTAFAC ,
      POTENCIAFPDIF ,
      ENERGACTFRAPTAFACTOR ,
      TOTALMESACT ,
      REPOMANCNX ,
      ENERGREACANTERI ,
      ENERGREACTOTAL ,
      SUBTOTALMES ,
      COD_ORGRECIBO_LUZ ,
      ENERGACTFRAPTAACTUAL ,
      ENERGREACPREUNI ,
      POTENCIAHPACT ,
      POTENCIAFPCONS ,
      ENERGACTFRAPTADIFER ,
      ENERGACTHORPTAACTU ,
      FEC_PERIODO ,
      --NUM_LECTURA_INICIAL ,
      POTENCIAFPFAC ,
      POTENCIAFPINI ,
      ENERGACTHORPTADIF ,
      --NUM_MONTO ,
      NUM_ESTADO ,
      CUOTACONV ,
      ENERGACTHORPTAPREUNI ,
      ENERGACTHORPTACONFAC ,
      POTENCIAHPDIF ,
      CARGOFIJO ,
      POTENCIAFPANTE ,
      POTGENFPPREUNI ,
      APORTELEY ,
      ENERGACTFRAPTATOTAL ,
      NUM_COSTO_WATS ,
      POTENCIAHPCONS ,
      POTGENFPCONFAC ,
      ENERGREACFACTOR ,
      ENERGACTHORPTATOTAL ,
      ENERGACTHORPTAANT ,
      ENERGACTFRAPTAANTERI ,
      INTERESCONVENIO ,
      REDONMESACT ,
      POTENCIAHPFAC ,
      ENERGACTFRAPTACONFA ,
      ENERGREACCONSU ,
      --NUM_LECTURA_FINAL ,
      POTENCIAHPANT ,
      ENERGREACINICIAL ,
      ALUMPUBLIC ,
      IGV ,
      ENERGACTFRAPTAPREUNI ,
      ENERGACTFRAPTACONSU ,
      REDONMESANT ,
      ENERGACTHORPTACONS ,
      POTUSOREDDISTPREUNI ,
      ENERGREACDIFERE ,
      --NUM_PENDIENTE_FAC ,
      POTUSOREDDISTCONFAC,
      POTUSOREDDISTTOTAL,
      POTGENFPTOTAL,
      FECVENCIMIENTO,
      FECEMISION
    )
    VALUES
    (
      p_ENERGREACFACCONS ,
      p_ENERGACTHORPTAFAC ,
      p_POTENCIAFPDIF ,
      p_ENERGACTFRAPTAFACTOR ,
      p_TOTALMESACT ,
      p_REPOMANCNX ,
      p_ENERGREACANTERI ,
      p_ENERGREACTOTAL ,
      p_SUBTOTALMES ,
      vl_codigo,
      p_ENERGACTFRAPTAACTUAL ,
      p_ENERGREACPREUNI ,
      p_POTENCIAHPACT ,
      p_POTENCIAFPCONS ,
      p_ENERGACTFRAPTADIFER ,
      p_ENERGACTHORPTAACTU ,
      vl_periodo,
      --p_FEC_PERIODO ,
      --p_NUM_LECTURA_INICIAL ,
      p_POTENCIAFPFAC ,
      p_POTENCIAFPINI ,
      p_ENERGACTHORPTADIF ,
      --p_NUM_MONTO ,
      p_NUM_ESTADO ,
      p_CUOTACONV ,
      p_ENERGACTHORPTAPREUNI ,
      p_ENERGACTHORPTACONFAC ,
      p_POTENCIAHPDIF ,
      p_CARGOFIJO ,
      p_POTENCIAFPANTE ,
      p_POTGENFPPREUNI ,
      p_APORTELEY ,
      p_ENERGACTFRAPTATOTAL ,
      p_NUM_COSTO_WATS ,
      p_POTENCIAHPCONS ,
      p_POTGENFPCONFAC ,
      p_ENERGREACFACTOR ,
      p_ENERGACTHORPTATOTAL ,
      p_ENERGACTHORPTAANT ,
      p_ENERGACTFRAPTAANTERI ,
      p_INTERESCONVENIO ,
      p_REDONMESACT ,
      p_POTENCIAHPFAC ,
      p_ENERGACTFRAPTACONFA ,
      p_ENERGREACCONSU ,
      --p_NUM_LECTURA_FINAL ,
      p_POTENCIAHPANT ,
      p_ENERGREACINICIAL ,
      p_ALUMPUBLIC ,
      p_IGV ,
      p_ENERGACTFRAPTAPREUNI ,
      p_ENERGACTFRAPTACONSU ,
      p_REDONMESANT ,
      p_ENERGACTHORPTACONS ,
      p_POTUSOREDDISTPREUNI ,
      p_ENERGREACDIFERE ,
      --p_NUM_PENDIENTE_FAC ,
      p_POTUSOREDDISTCONFAC,
      p_POTUSOREDDISTTOTAL,
      p_POTGENFPTOTAL,
      p_FECVENCIMIENTO,
      p_FECEMISION
    );
COMMIT;

      vo_codigo_recibo := vl_codigo;
      vo_indicador := '00';
      vo_mensaje := 'Se registro satisfactoriamente el Recibo de Luz Original.';

EXCEPTION 
  WHEN OTHERS THEN
    vo_codigo_recibo := 0;
    vo_indicador := '01';
    vo_mensaje := SQLCODE || ' - ' || SQLERRM;
    ROLLBACK;

END;
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
  PROCEDURE SP_REPORTE_LUZ_ORIG(vi_pagina               IN  NUMBER,
                              vi_registros              IN  NUMBER,
                              vi_codigo_recibo_luz_orig IN  VARCHAR,
                              vo_total_registros        OUT NUMBER,
                              vo_result                 OUT SYS_REFCURSOR) AS
  vl_inicio NUMBER;
  vl_fin    NUMBER;                              
  BEGIN
    
    vl_fin := vi_pagina * vi_registros;
    vl_inicio := vl_fin - (vi_registros - 1);
    
    dbms_output.put_line ('INICIO : ' || vl_inicio); 
    dbms_output.put_line ('FIN : ' || vl_fin); 
    
    IF vi_codigo_recibo_luz_orig = '0' THEN
    
        SELECT COUNT(*) INTO vo_total_registros
        FROM sis_reciboluz_org p;
        
        OPEN vo_result FOR
            SELECT cod_orgrecibo_luz, fec_periodo, fecemision, fecvencimiento, totalmesact
            FROM (
                SELECT cod_orgrecibo_luz, fec_periodo, fecemision, fecvencimiento, totalmesact, ROWNUM numfila
                FROM (
                      SELECT cod_orgrecibo_luz, fec_periodo, fecemision, fecvencimiento, totalmesact
                      FROM sis_reciboluz_org p
                ) A
            ) B
            WHERE numfila BETWEEN vl_inicio AND vl_fin;
            
    ELSE
    
        SELECT COUNT(*) INTO vo_total_registros
        FROM sis_reciboluz_org p
        WHERE p.cod_orgrecibo_luz = vi_codigo_recibo_luz_orig;
        
        OPEN vo_result FOR
            SELECT cod_orgrecibo_luz, fec_periodo, fecemision, fecvencimiento, totalmesact
            FROM (
                SELECT cod_orgrecibo_luz, fec_periodo, fecemision, fecvencimiento, totalmesact, ROWNUM numfila
                FROM (
                      SELECT cod_orgrecibo_luz, fec_periodo, fecemision, fecvencimiento, totalmesact
                      FROM sis_reciboluz_org p
                      WHERE p.cod_orgrecibo_luz = vi_codigo_recibo_luz_orig
                ) A
            ) B
            WHERE numfila BETWEEN vl_inicio AND vl_fin;
        
    END IF;
  END SP_REPORTE_LUZ_ORIG;
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --

END PKG_RECIBO_LUZ_ORIG;




  CREATE TABLE "ACMMH"."SIS_RECIBOLUZ_SOCIO" 
   (	"CODIGOSOCIO" NUMBER(*,0) NOT NULL ENABLE, 
	"CODIGORECIBO" NUMBER(*,0) NOT NULL ENABLE, 
	"CORRELATIVO" NUMBER(*,0) NOT NULL ENABLE, 
	"LECTURAINICIAL" NUMBER(*,0), 
	"LECTURAFINAL" NUMBER(*,0), 
	"CONSUMOMES" NUMBER(*,0), 
	"CARGOFIJO" NUMBER(9,2), 
	"ALUMBRADOPUBLICO" NUMBER(9,2), 
	"CARGOENERGIA" NUMBER(9,2), 
	"SUBTOTALMES" NUMBER(9,2), 
	"IGV" NUMBER(9,2), 
	"TOTALMES" NUMBER(9,2), 
	"USOEQUIPO" NUMBER(9,2), 
	"SERVICIOMANTENIMIENTO" NUMBER(9,2), 
	"APORTELEY" NUMBER(9,2), 
	"RECARGO" NUMBER(9,2), 
	"REDONDEO" NUMBER(9,2), 
	"TOTAL" NUMBER(9,2), 
	"ESTADO" NUMBER DEFAULT 1, 
	"DEUDAANTERIOR" NUMBER(9,2) DEFAULT 0.00, 
	"FECHACARGA" TIMESTAMP (6) DEFAULT systimestamp, 
	"IMPRESO" NUMBER DEFAULT 0, 
	 CONSTRAINT "SIS_RECIBOLUZ_SOCIO_PK" PRIMARY KEY ("CORRELATIVO", "CODIGOSOCIO", "CODIGORECIBO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

  
  
-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
  create or replace PACKAGE "PKG_RECIBO_LUZ_SOCIO" AS
TYPE CUR_LIST IS REF CURSOR;
-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
  PROCEDURE SP_REPORTE_PUESTO_LUZ_SOCIO(vi_pagina       IN  NUMBER,
                              vi_registros              IN  NUMBER,
                              vi_codigo_puesto          IN  NUMBER,
                              vo_total_registros        OUT NUMBER,
                              vo_result                 OUT SYS_REFCURSOR);
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
END PKG_RECIBO_LUZ_SOCIO;
-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --





-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
create or replace PACKAGE BODY "PKG_RECIBO_LUZ_SOCIO" 
AS

  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
  PROCEDURE SP_REPORTE_PUESTO_LUZ_SOCIO(vi_pagina       IN  NUMBER,
                              vi_registros              IN  NUMBER,
                              vi_codigo_puesto          IN  NUMBER,
                              vo_total_registros        OUT NUMBER,
                              vo_result                 OUT SYS_REFCURSOR) AS
  vl_inicio NUMBER;
  vl_fin    NUMBER;                              
  BEGIN
    
    vl_fin := vi_pagina * vi_registros;
    vl_inicio := vl_fin - (vi_registros - 1);
    
    dbms_output.put_line ('INICIO : ' || vl_inicio); 
    dbms_output.put_line ('FIN : ' || vl_fin); 
    
    IF vi_codigo_puesto = '0' THEN
    
        SELECT COUNT(*) INTO vo_total_registros
        FROM sis_puesto p;
        
        OPEN vo_result FOR
            SELECT codigo_puesto, codigo_usuario, nro_puesto, codigo_giro, estado, recibo_luz, total, recibo_luz_creado
            FROM (
                SELECT codigo_puesto, codigo_usuario, nro_puesto, codigo_giro, estado, recibo_luz, total, recibo_luz_creado, ROWNUM numfila
                FROM (
                      SELECT codigo_puesto, codigo_usuario, nro_puesto, codigo_giro, estado, recibo_luz,
                            nvl((SELECT total FROM sis_reciboluz_socio 
                                WHERE codigosocio = nro_puesto and codigorecibo in (SELECT cod_orgrecibo_luz FROM sis_reciboluz_org) ),0) total,
                            nvl((SELECT 1 FROM sis_reciboluz_socio 
                                WHERE codigosocio = nro_puesto and codigorecibo in (SELECT cod_orgrecibo_luz FROM sis_reciboluz_org) ),0) recibo_luz_creado
                      FROM sis_puesto p
                      WHERE recibo_luz = 1
                ) A
            ) B
            WHERE numfila BETWEEN vl_inicio AND vl_fin;
            
    ELSE
    
        SELECT COUNT(*) INTO vo_total_registros
        FROM sis_puesto p
        WHERE p.codigo_puesto = vi_codigo_puesto;
        
        OPEN vo_result FOR
            SELECT codigo_puesto, codigo_usuario, nro_puesto, codigo_giro, estado, recibo_luz, total, recibo_luz_creado
            FROM (
                SELECT codigo_puesto, codigo_usuario, nro_puesto, codigo_giro, estado, recibo_luz, total, recibo_luz_creado, ROWNUM numfila
                FROM (
                      SELECT codigo_puesto, codigo_usuario, nro_puesto, codigo_giro, estado, recibo_luz,
                            nvl((SELECT total FROM sis_reciboluz_socio 
                                WHERE codigosocio = nro_puesto and codigorecibo in (SELECT cod_orgrecibo_luz FROM sis_reciboluz_org) ),0) total,
                            nvl((SELECT 1 FROM sis_reciboluz_socio 
                                WHERE codigosocio = nro_puesto and codigorecibo in (SELECT cod_orgrecibo_luz FROM sis_reciboluz_org) ),0) recibo_luz_creado
                      FROM sis_puesto p
                      WHERE p.codigo_puesto = vi_codigo_puesto and recibo_luz = 1
                ) A
            ) B
            WHERE numfila BETWEEN vl_inicio AND vl_fin;
        
    END IF;
  END SP_REPORTE_PUESTO_LUZ_SOCIO;
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --

END PKG_RECIBO_LUZ_SOCIO;
-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --